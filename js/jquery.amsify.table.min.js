// Amsify42 Table 1.0.0
// http://www.amsify42.com
!function(t,e,o){function a(t,e,a){var n="amsify-column-input";return"bootstrap"==t?n+=" form-control":"materialize"==t&&(n+=" browser-default"),e!==o&&(e=e.toLowerCase(),("date"==e||0==e.indexOf("date"))&&(n+=" datepicker",a!==o&&""!=a?r(t,a):r(t))),n}function r(t,a){var r="yy-mm-dd";a!==o&&(r=a),e("bootstrap"==t?function(){e(".datepicker").datepicker({dateFormat:r})}:function(){e(".datepicker").datepicker({dateFormat:r})})}function n(t){t!==o&&(t.tableSelector!==o&&(l=t.tableSelector),t.type!==o&&(s=t.type),t.tableSelector!==o&&(l=t.tableSelector),t.sortSelector!==o&&(c=t.sortSelector),t.contentType!==o&&(d=t.contentType),t.paginateSelector!==o&&(f=t.paginateSelector),t.ajaxMethod!==o&&(p=t.ajaxMethod),t.afterSort!==o&&(i=t.afterSort))}var i,s="bootstrap",l="table",c=".amsify-sort-table",d="table",f="#pagination",p="sort.php",u=".amsify-sort-paginate";e.fn.amsifyTableSort=function(e){if(e!==o)e.tableSelector=this;else var e={tableSelector:this};t.setSort(e)},t.init=function(e){n(e);var o=new t.Table;o.set()},t.set=function(e){var o=new t.Table;o.set(e)},t.Table=function(){t.Table.prototype.set=function(e){e!==o?t.setSort(e):t.setSort(),AmsifyHelper.bodyLoaderIEfix()}},t.setSort=function(r){var n=s,i="amsify",d=l,f=c;r!==o&&(r.type!==o&&(n=r.type,i=r.type),r.tableSelector!==o&&(d=r.tableSelector),r.sortSelector!==o&&(f=r.sortSelector)),e(d).each(function(s,l){e(d).attr("amsify-table-type",i);var c=[],p=[],u=e(this).find(f);if(e.each(u,function(t,o){var r=e.trim(e(o).text());if(c.push(r),e(o).hasClass("skip"))e(o).removeClass(f.substring(1)),p[r]="";else if(e(o).attr("selecthtml")){var i=e(o).attr("selecthtml");p[r]='<select class="'+a(n)+'">'+e(i).html()+"</select>"}else e(o).attr("datepicker")?p[r]='<input type="text" placeholder="'+r+'" class="'+a(n,"date",e(o).attr("datepicker"))+'"/>':p[r]='<input type="text" placeholder="'+r+'" class="'+a(n,r)+'"/>'}),e(this).attr("data-method")&&(r===o&&(r={}),r.ajaxMethod=e(this).data("method")),e(this).attr("drag-sortable")){var m=e(this).attr("drag-sortable");e(this).find("tbody").addClass("tbody"),AmsifyHelper.setDraggableSort(e(this).find(".tbody"),m,"id",{},r)}t.setColumnInputs(this,c,p),t.sortRows(this,f,r),t.sortPaginate(this,r)})},t.callAjax=function(t,o,a){var r=e(o).attr("drag-sortable"),n={ids:a,_token:AmsifyHelper.getToken()},i={};i.beforeSend=function(){e(".section-body-loader").show(),e(t).sortable("disable")},i.afterResponseError=function(o){e(t).sortable("cancel")},i.complete=function(){e(".section-body-loader").hide(),e(t).sortable("enable")},AmsifyHelper.callAjax(r,n,i)},t.sortPaginate=function(a,r){var n=u,i=d,s=p,l=f;r!==o&&(r.sortPaginate!==o&&(n=r.sortPaginate),r.contentType!==o&&(i=r.contentType),r.ajaxMethod!==o&&(s=r.ajaxMethod),r.paginateSelector!==o&&(l=r.paginateSelector)),e(document).on("click",n,function(o){o.preventDefault();var n=e(this).data("column"),c=e(this).data("type"),d=e(this).data("page"),f=e(this).data("input"),p=e(this).attr("href");p?s=p:e(a).data("method")&&(s=AmsifyHelper.getActionURL(e(a).data("method"))),t.loadSortedResult(n,f,c,a,i,l,s,d,r)})},t.setColumnInputs=function(t,o,a){var r='<tr class="amsify-column-input-span">';e.each(o,function(t,e){r+="<td>"+a[e]+"</td>"}),r+="</tr>",e(t).find("thead").append(r)},t.sortRows=function(a,r,n){var i=s,l=d,c=p,u=f;n!==o&&(n.type!==o&&(i=n.type),n.contentType!==o&&(l=n.contentType),n.ajaxMethod!==o&&(c=n.ajaxMethod),n.paginateSelector!==o&&(u=n.paginateSelector)),AmsifyHelper.setDefaultSortIcon(r,i),e(document).on("click",r,function(n){if(n.stopImmediatePropagation(),e(r).removeClass("active-sort"),e(this).addClass("active-sort"),e(this).hasClass("skip"))return!1;var s=e(this).html(),d=e(this).clone().children().remove().end().text(),f=e(this).parent("th").index();if(e(this).data("selecthtml"))var p=e(this).closest("tr").next().children().eq(f).find(".amsify-column-input").find(":selected").val();else var p=e(this).closest("tr").next().children().eq(f).find(".amsify-column-input").val();p===o&&(p="");var m=AmsifyHelper.getSortIcon(s,i,p),h=m.basic,y=m.insertHtml;t.loadSortedResult(d,p,m.sort_type,a,l,u,AmsifyHelper.getActionURL(c),1),"bootstrap"==i?(e(r).find(".fa").remove(),e(this).find(".fa").remove()):(e(r).find(".sort-icon").remove(),e(this).find(".sort-icon").remove()),e(r).not(this).append(h),e(this).append(y),e(".amsify-column-input").val(""),e(this).closest("tr").next().children().eq(f).find(".amsify-column-input").val(p)}),e(document).on("keyup",".amsify-column-input",function(t){if(t.stopImmediatePropagation(),13==t.keyCode){var o=e(this).parent("td").index();e(this).closest("tr").prev().children().eq(o).find(r).click()}}),e(document).on("change",".amsify-column-input",function(t){if(t.stopImmediatePropagation(),13!=t.keyCode){var o=e(this).parent("td").index();e(this).closest("tr").prev().children().eq(o).find(r).click()}})},t.loadSortedResult=function(t,a,r,n,i,s,l,c,d){var f={column:t,input:a,type:r,page:c,_token:AmsifyHelper.getToken()},p={};p.beforeSend=function(){e(".section-body-loader").show(),e(n).css("opacity",.5)},p.afterSuccess=function(t){"table"==i?e(n).find("tbody").html(t.html):e(n).html(t.html),e(s).html(t.links)},p.complete=function(t){e(n).css("opacity","1"),e(".section-body-loader").hide(),AmsifyHelper.showURL("",c),d!==o&&d.afterSort&&"function"==typeof d.afterSort&&d.afterSort(t)},AmsifyHelper.callAjax(l,f,p)},t.tableOperation=function(e,o,a,r){"add"==e?t.addRow(o,r):"update"==e?t.updateRow(o,a,r):"delete"==e&&t.removeRow(o,a)},t.addRow=function(t,o){"table"==t?($table=e(t+" tbody"),$table.find(".amsify-not-found").remove(),e(o).prependTo($table).children().first().prepend(AmsifyHelper.reorderImage(e(t).attr("amsify-table-type"))),e(t+" tbody tr:first").css({"background-color":"#CCFFCC",color:""}),setTimeout(function(){e(t+" tbody tr:first").css({"background-color":"",color:""})},3e3)):($table=e(t),$table.find(".amsify-not-found").remove(),$table.children("div:eq(0)").after(o),e(t+" div:eq(1)").css({"background-color":"#CCFFCC",color:""}),setTimeout(function(){e(t+" div:eq(1)").css({"background-color":"",color:""})},3e3))},t.updateRow=function(t,o,a){"table"==t?$row=e(t).closest("table").find("tbody tr:eq("+o+")"):$row=e(t+" div:eq("+o+")"),$row.empty().html(a).css({"background-color":"#2FAFE5",color:""}),$row.children().first().prepend(AmsifyHelper.reorderImage(e(t).attr("amsify-table-type"))),setTimeout(function(){$row.css({"background-color":"",color:""})},3e3)},t.removeRow=function(t,o){"table"==t?$row=e(t).closest("table").find("tbody tr:eq("+o+")"):$row=e(t+" div:eq("+o+")"),$row.css({"background-color":"#FF9999",color:""}),setTimeout(function(){$row.css({"background-color":"",color:""})},3e3),$row.fadeOut(3e3),setTimeout(function(){$row.remove()},3e3)}}(window.AmsifyTable=window.AmsifyTable||{},jQuery);